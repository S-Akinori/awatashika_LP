---
import FadeIn from "./FadeIn.astro";
import Title from "./Title.astro";
import SectionWrapper from "./SectionWrapper.astro";
import RoundBackground from "./RoundBackground.astro";
import { parseBracketedText } from "@/lib/parseBracketedText";
import Card from "./Card.astro";
import CardHeader from "./CardHeader.astro";
import bg from '../assets/bg.png';

const response = await fetch(import.meta.env.CMS_ENDPOINT+'?sheet=feature,feature_lists,feature_contents');
const data = await response.json();
const feature = data.feature[0];
const feaatureLists = data.feature_lists;
const featureContents = data.feature_contents;
---

<div id="program" class:list={["py-12 bg-cover bg-center bg-no-repeat"]} style={`background-image: url(${bg.src})`}>
    <SectionWrapper>
        <FadeIn>
            <Title class="mb-4">{feature.title}</Title>
        </FadeIn>
        <div class="flex flex-wrap justify-center items-center mb-4">
            {feaatureLists.map((item, index) => (
                <div class={index === 0 ? "w-full md:w-1/3 md:p-4 flex justify-center" : "w-1/2 md:w-1/3 md:p-4"}>
                    <div class={index === 0 ? "w-1/2 md:w-full" : "md:w-full"}>
                        <FadeIn delay={`${index * 0.2}s`}>
                            <RoundBackground>
                                {item.title}
                            </RoundBackground>
                        </FadeIn>
                    </div>
                </div>
            ))}
        </div>
        <div class="flex flex-col md:flex-row justify-center gap-4 mt-8">
            {featureContents.map((content, index) => {
                const titles = parseBracketedText(content.title);
                return (
                    <div class="md:w-1/2">
                        <FadeIn delay={`${index * 0.2}s`}>
                            <Card>
                                <CardHeader>{titles[0]} <span class="text-accent">{titles[1]}</span></CardHeader>
                                <div class="p-4 whitespace-pre-wrap">
                                    {content.text}
                                </div>
                            </Card>
                        </FadeIn>
                    </div>
                )
            }
            )}
        </div>
    </SectionWrapper>
</div>